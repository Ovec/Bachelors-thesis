install:
	kubectl apply -f ./install/install.yaml

create:
	kubectl apply -f ./create/high-availability/ha-postgres.yaml

test:
	trivy k8s --report summary cluster --timeout 3600s

testImages:
	trivy image stackgres/operator:1.4.3 --scanners vuln | grep Total
	trivy image stackgres/admin-ui:1.4.3 --scanners vuln | grep Total
	trivy image stackgres/restapi:1.4.3 --scanners vuln | grep Total
	trivy image docker.io/ongres/envoy:v1.24.0-build-6.18 --scanners vuln | grep Total
	trivy image docker.io/ongres/patroni:v2.1.4-pg14.6-build-6.18 --scanners vuln | grep Total
	trivy image docker.io/ongres/pgbouncer:v1.17.0-build-6.17 --scanners vuln | grep Total
	trivy image docker.io/ongres/postgres-util:v14.6-build-6.18 --scanners vuln | grep Total
	trivy image docker.io/ongres/prometheus-postgres-exporter:v0.11.1-build-6.17 --scanners vuln | grep Total

remove:
	kubectl delete -f  ./create/high-availability/ha-postgres.yaml

uninstall:
	kubectl delete -f https://raw.githubusercontent.com/cloudnative-pg/cloudnative-pg/release-1.19/releases/cnpg-1.19.2.yaml


.PHONY: install create test remove uninstall