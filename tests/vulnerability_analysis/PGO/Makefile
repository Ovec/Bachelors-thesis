install:
	kubectl apply --server-side -k ./install/namespace
	kubectl apply --server-side -k ./install/default

create:
	kubectl apply -k ./create/high-availability

test:
	trivy k8s --report summary cluster --timeout 3600s

testImages:
	trivy image registry.developers.crunchydata.com/crunchydata/postgres-operator:ubi8-5.3.1-0 --scanners vuln | grep Total
	trivy image registry.developers.crunchydata.com/crunchydata/postgres-operator-upgrade:ubi8-5.3.1-0 --scanners vuln | grep Total
	trivy image registry.developers.crunchydata.com/crunchydata/crunchy-pgbouncer:ubi8-1.18-0 --scanners vuln | grep Total
	trivy image registry.developers.crunchydata.com/crunchydata/crunchy-postgres:ubi8-14.7-0 --scanners vuln | grep Total
	trivy image registry.developers.crunchydata.com/crunchydata/crunchy-pgbackrest:ubi8-2.41-4 --scanners vuln --timeout 3600s | grep Total


remove:
	kubectl delete -k ./create/high-availability

uninstall:
	kubectl delete -k ./install/namespace
	kubectl delete -k ./install/default

.PHONY: install create test remove uninstall