#!/bin/bash

# create cluster
kind create cluster --name kind --config ../../environments/kind_cluster/config.yaml

# install operator
kubectl apply --server-side -k ./install/namespace
kubectl apply --server-side -k ./install/default

echo "Press Enter if Operator is installed"
read

# create cluster
kubectl apply -k ./create/high-availability

echo "Press Enter if Cluster is created"
read

# test
filename="results_$(date +'%Y-%m-%d').txt"
trivy k8s --report summary cluster --timeout 3600s >"$filename"

# remove cluster
kind delete cluster --name kind
