install:
	kubectl apply -f ./install/install.yaml
	
create:
	kubectl create ns postgres-operator
	kubectl apply -f ./create/high-availability/ha-postgres.yaml

test:
	trivy k8s --report summary cluster --timeout 3600s

testImages:
	trivy image ghcr.io/cloudnative-pg/cloudnative-pg:1.19.2 --scanners vuln | grep Total
	trivy image ghcr.io/cloudnative-pg/postgresql:14.7 --scanners vuln | grep Total

remove:
	kubectl delete -f  ./create/high-availability/ha-postgres.yaml
	kubectl delete ns postgres-operator

uninstall:
	kubectl delete -f https://raw.githubusercontent.com/cloudnative-pg/cloudnative-pg/release-1.19/releases/cnpg-1.19.2.yaml


.PHONY: install create test remove uninstall