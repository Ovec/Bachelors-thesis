#!/bin/bash

# create cluster
kind create cluster --name kind --config ../../environments/kind_cluster/config.yaml

# install operator
kubectl create namespace pgo
kubectl config set-context "$(kubectl config current-context)" --namespace=pgo
kubectl apply -f ./install/install.yaml

echo "Press Enter if Operator is installed"
read

# create cluster
kubectl apply -f ./create/high-availability/ha-postgres.yaml

echo "Press Enter if Cluster is created"
read

# test
filename="results_$(date +'%Y-%m-%d').txt"
trivy k8s --report summary cluster --timeout 3600s >"$filename"

# remove cluster
kind delete cluster --name kind
